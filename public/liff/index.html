<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>âœˆï¸ èˆªç­æ¯”åƒ¹æœå°‹</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœˆï¸</text></svg>">
  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    :root {
      --primary: #1a73e8;
      --primary-light: #e8f0fe;
      --danger: #d93025;
      --success: #188038;
      --warning: #f29900;
      --bg: #f0f2f5;
      --card: #ffffff;
      --text: #1f1f1f;
      --text-secondary: #5f6368;
      --border: #dadce0;
      --radius: 12px;
      --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-lg: 0 4px 14px rgba(0,0,0,0.1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans TC', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%);
      color: white;
      padding: 20px 16px 16px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .header h1 { font-size: 20px; font-weight: 700; }
    .header .subtitle { font-size: 13px; opacity: 0.85; margin-top: 2px; }

    /* Search Form */
    .search-section {
      background: var(--card);
      margin: 12px;
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 12px;
    }

    .form-group { display: flex; flex-direction: column; }
    .form-group label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-group input, .form-group select {
      padding: 10px 12px;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-size: 15px;
      color: var(--text);
      background: #fafafa;
      transition: border-color 0.2s, box-shadow 0.2s;
      -webkit-appearance: none;
    }
    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.15);
      background: white;
    }

    /* Airline Chips */
    .airline-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 14px;
    }
    .airline-chip {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border: 1.5px solid var(--border);
      background: white;
      color: var(--text-secondary);
      transition: all 0.2s;
      user-select: none;
    }
    .airline-chip.active {
      border-color: var(--primary);
      background: var(--primary-light);
      color: var(--primary);
    }
    .airline-chip:active { transform: scale(0.95); }

    /* Search Button */
    .btn-search {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-search:active { transform: scale(0.98); }
    .btn-search:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .btn-search .spinner {
      width: 18px; height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* Sort Bar */
    .sort-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      font-size: 13px;
      color: var(--text-secondary);
      overflow-x: auto;
    }
    .sort-btn {
      padding: 5px 12px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: white;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }
    .sort-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* Results */
    .results-section { padding: 0 12px 100px; }
    .results-count {
      font-size: 13px;
      color: var(--text-secondary);
      padding: 8px 4px;
    }
    .results-count strong { color: var(--primary); }

    /* Flight Card */
    .flight-card {
      background: var(--card);
      border-radius: var(--radius);
      margin-bottom: 10px;
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: box-shadow 0.2s;
    }
    .flight-card:active { box-shadow: var(--shadow-lg); }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 14px 0;
    }
    .airline-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      font-weight: 600;
    }
    .airline-dot {
      width: 10px; height: 10px;
      border-radius: 50%;
      display: inline-block;
    }
    .flight-number {
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 400;
    }
    .cabin-tag {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
      background: #f0f0f0;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .card-body { padding: 10px 14px; }

    .time-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .time-block { text-align: center; }
    .time-block .time {
      font-size: 22px;
      font-weight: 700;
      color: var(--text);
      line-height: 1.2;
    }
    .time-block .airport {
      font-size: 11px;
      color: var(--text-secondary);
    }

    .route-line {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .route-line .duration {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    .route-line .line {
      width: 100%;
      height: 2px;
      background: var(--border);
      position: relative;
    }
    .route-line .line::after {
      content: '';
      position: absolute;
      right: -1px; top: -3px;
      border: 4px solid transparent;
      border-left-color: var(--border);
    }
    .route-line .stops-label {
      font-size: 11px;
      margin-top: 4px;
      font-weight: 600;
    }
    .stops-direct { color: var(--success); }
    .stops-transfer { color: var(--warning); }

    .card-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px 12px;
      border-top: 1px solid #f0f0f0;
    }
    .price {
      font-size: 20px;
      font-weight: 700;
      color: var(--danger);
    }
    .price .currency {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
    }
    .aircraft-info {
      font-size: 11px;
      color: var(--text-secondary);
    }
    .btn-book {
      padding: 8px 18px;
      border-radius: 8px;
      border: none;
      background: var(--primary);
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      transition: opacity 0.2s;
    }
    .btn-book:active { opacity: 0.85; }

    /* Status Messages */
    .status-message {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
    }
    .status-message .icon { font-size: 48px; margin-bottom: 12px; }
    .status-message .title { font-size: 16px; font-weight: 600; margin-bottom: 4px; color: var(--text); }
    .status-message .desc { font-size: 14px; line-height: 1.6; }

    /* Loading Skeleton */
    .skeleton-card {
      background: var(--card);
      border-radius: var(--radius);
      margin-bottom: 10px;
      padding: 16px;
      box-shadow: var(--shadow);
    }
    .skeleton-line {
      height: 14px;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .skeleton-line.w60 { width: 60%; }
    .skeleton-line.w40 { width: 40%; }
    .skeleton-line.w80 { width: 80%; }
    .skeleton-line.h24 { height: 24px; }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Swap button */
    .swap-btn {
      width: 32px; height: 32px;
      border-radius: 50%;
      border: 1.5px solid var(--border);
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      align-self: flex-end;
      margin-bottom: 8px;
      transition: background 0.2s;
    }
    .swap-btn:active { background: var(--primary-light); }

    .form-row-3 {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 6px;
      margin-bottom: 12px;
    }

    /* Responsive */
    @media (min-width: 480px) {
      .search-section { margin: 16px auto; max-width: 520px; }
      .results-section { max-width: 520px; margin: 0 auto; padding-bottom: 40px; }
      .sort-bar { max-width: 520px; margin: 0 auto; }
    }
  </style>
</head>
<body>

<div class="header">
  <h1>âœˆï¸ èˆªç­æ¯”åƒ¹æœå°‹</h1>
  <div class="subtitle">Amadeus å…¨çƒèˆªç©ºè¨‚ä½ç³»çµ± å³æ™‚æŸ¥è©¢</div>
</div>

<!-- Search Form -->
<div class="search-section">
  <div class="form-row-3">
    <div class="form-group">
      <label>å‡ºç™¼åœ°</label>
      <input type="text" id="origin" placeholder="TPE" maxlength="3" value="TPE">
    </div>
    <button class="swap-btn" onclick="swapCities()" title="äº¤æ›">â‡„</button>
    <div class="form-group">
      <label>ç›®çš„åœ°</label>
      <input type="text" id="destination" placeholder="NRT" maxlength="3">
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>å»ç¨‹æ—¥æœŸ</label>
      <input type="date" id="departDate">
    </div>
    <div class="form-group">
      <label>å›ç¨‹æ—¥æœŸ</label>
      <input type="date" id="returnDate">
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>è‰™ç­‰</label>
      <select id="cabinClass">
        <option value="">å…¨éƒ¨è‰™ç­‰</option>
        <option value="ECONOMY">ç¶“æ¿Ÿè‰™</option>
        <option value="PREMIUM_ECONOMY">è±ªè¯ç¶“æ¿Ÿè‰™</option>
        <option value="BUSINESS">å•†å‹™è‰™</option>
        <option value="FIRST">é ­ç­‰è‰™</option>
      </select>
    </div>
    <div class="form-group">
      <label>äººæ•¸</label>
      <select id="adults">
        <option value="1">1 ä½æˆäºº</option>
        <option value="2">2 ä½æˆäºº</option>
        <option value="3">3 ä½æˆäºº</option>
        <option value="4">4 ä½æˆäºº</option>
      </select>
    </div>
  </div>

  <label style="font-size:12px;font-weight:600;color:var(--text-secondary);margin-bottom:6px;display:block;text-transform:uppercase;letter-spacing:0.5px;">èˆªç©ºå…¬å¸</label>
  <div class="airline-chips" id="airlineChips">
    <div class="airline-chip active" data-code="CI" style="--c:#D7177E" onclick="toggleChip(this)">ğŸ‡¹ğŸ‡¼ è¯èˆª</div>
    <div class="airline-chip active" data-code="BR" style="--c:#00694A" onclick="toggleChip(this)">ğŸ‡¹ğŸ‡¼ é•·æ¦®</div>
    <div class="airline-chip active" data-code="JX" style="--c:#8B6914" onclick="toggleChip(this)">ğŸ‡¹ğŸ‡¼ æ˜Ÿå®‡</div>
    <div class="airline-chip" data-code="EK" style="--c:#D71921" onclick="toggleChip(this)">ğŸ‡¦ğŸ‡ª é˜¿è¯é…‹</div>
    <div class="airline-chip" data-code="TK" style="--c:#C80815" onclick="toggleChip(this)">ğŸ‡¹ğŸ‡· åœŸèˆª</div>
    <div class="airline-chip" data-code="CX" style="--c:#006564" onclick="toggleChip(this)">ğŸ‡­ğŸ‡° åœ‹æ³°</div>
    <div class="airline-chip" data-code="SQ" style="--c:#F2A900" onclick="toggleChip(this)">ğŸ‡¸ğŸ‡¬ æ–°èˆª</div>
  </div>

  <button class="btn-search" id="searchBtn" onclick="doSearch()">
    <span id="searchBtnText">ğŸ” æœå°‹èˆªç­</span>
  </button>
</div>

<!-- Sort Bar -->
<div class="sort-bar" id="sortBar" style="display:none;">
  <span>æ’åºï¼š</span>
  <button class="sort-btn active" data-sort="price" onclick="sortResults(this,'price')">ğŸ’° åƒ¹æ ¼</button>
  <button class="sort-btn" data-sort="depart" onclick="sortResults(this,'depart')">ğŸ• å‡ºç™¼æ™‚é–“</button>
  <button class="sort-btn" data-sort="duration" onclick="sortResults(this,'duration')">â± é£›è¡Œæ™‚é–“</button>
  <button class="sort-btn" data-sort="stops" onclick="sortResults(this,'stops')">ğŸ”„ è½‰æ©Ÿæ¬¡æ•¸</button>
</div>

<!-- Results -->
<div class="results-section" id="results"></div>

<script>
// =============================================
// è³‡æ–™èˆ‡ç‹€æ…‹
// =============================================
const AIRLINE_COLORS = {
  CI: '#D7177E', BR: '#00694A', JX: '#8B6914',
  EK: '#D71921', TK: '#C80815', CX: '#006564', SQ: '#F2A900'
};
const AIRLINE_NAMES = {
  CI: 'è¯èˆª', BR: 'é•·æ¦®', JX: 'æ˜Ÿå®‡',
  EK: 'é˜¿è¯é…‹', TK: 'åœŸèˆª', CX: 'åœ‹æ³°', SQ: 'æ–°èˆª'
};
const CABIN_NAMES = {
  ECONOMY: 'ç¶“æ¿Ÿè‰™', PREMIUM_ECONOMY: 'è±ªè¯ç¶“æ¿Ÿè‰™',
  BUSINESS: 'å•†å‹™è‰™', FIRST: 'é ­ç­‰è‰™'
};
const AIRCRAFT_NAMES = {
  '359': 'A350-900', '35K': 'A350-900', '351': 'A350-1000',
  '789': 'B787-9', '78J': 'B787-9', '788': 'B787-8',
  '77W': 'B777-300ER', '773': 'B777-300', '772': 'B777-200',
  '333': 'A330-300', '332': 'A330-200', '339': 'A330-900neo',
  '321': 'A321', '320': 'A320', '738': 'B737-800',
  '388': 'A380-800', '744': 'B747-400',
};

let currentFlights = [];
let currentSort = 'price';

// =============================================
// LIFF åˆå§‹åŒ– + URL åƒæ•¸è§£æ
// =============================================
(async function init() {
  // å¾ URL è®€å–æœå°‹åƒæ•¸ï¼ˆLINE Bot æœƒå¸¶åƒæ•¸éä¾†ï¼‰
  const params = new URLSearchParams(window.location.search);
  if (params.get('origin')) document.getElementById('origin').value = params.get('origin');
  if (params.get('destination')) document.getElementById('destination').value = params.get('destination');
  if (params.get('departDate')) document.getElementById('departDate').value = params.get('departDate');
  if (params.get('returnDate')) document.getElementById('returnDate').value = params.get('returnDate');
  if (params.get('cabinClass')) document.getElementById('cabinClass').value = params.get('cabinClass');
  if (params.get('adults')) document.getElementById('adults').value = params.get('adults');

  // è¨­å®šèˆªç©ºå…¬å¸ chips
  if (params.get('airlines')) {
    const codes = params.get('airlines').split(',');
    document.querySelectorAll('.airline-chip').forEach(chip => {
      chip.classList.toggle('active', codes.includes(chip.dataset.code));
    });
  }

  // è¨­å®šé è¨­æ—¥æœŸï¼ˆå¦‚æœæ²’æœ‰å¾ URL å¸¶å…¥ï¼‰
  if (!document.getElementById('departDate').value) {
    const d = new Date();
    d.setDate(d.getDate() + 14);
    document.getElementById('departDate').value = d.toISOString().slice(0, 10);
  }

  // å˜—è©¦åˆå§‹åŒ– LIFFï¼ˆå¯é¸ï¼‰
  try {
    const liffId = getLiffId();
    if (liffId && window.liff) {
      await liff.init({ liffId });
      console.log('LIFF initialized');
    }
  } catch (e) {
    console.log('LIFF init skipped:', e.message);
  }

  // å¦‚æœæœ‰å®Œæ•´åƒæ•¸ï¼Œè‡ªå‹•æœå°‹
  if (params.get('origin') && params.get('destination') && params.get('departDate')) {
    doSearch();
  }
})();

function getLiffId() {
  // LIFF ID å¯ä»¥å¾ meta tag æˆ–ç’°å¢ƒå–å¾—
  const meta = document.querySelector('meta[name="liff-id"]');
  return meta ? meta.content : null;
}

// =============================================
// UI äº’å‹•
// =============================================
function swapCities() {
  const o = document.getElementById('origin');
  const d = document.getElementById('destination');
  [o.value, d.value] = [d.value, o.value];
}

function toggleChip(el) {
  el.classList.toggle('active');
}

function getSelectedAirlines() {
  return Array.from(document.querySelectorAll('.airline-chip.active'))
    .map(el => el.dataset.code);
}

// =============================================
// æœå°‹
// =============================================
async function doSearch() {
  const origin = document.getElementById('origin').value.trim().toUpperCase();
  const destination = document.getElementById('destination').value.trim().toUpperCase();
  const departDate = document.getElementById('departDate').value;
  const returnDate = document.getElementById('returnDate').value;
  const cabinClass = document.getElementById('cabinClass').value;
  const adults = document.getElementById('adults').value;
  const airlines = getSelectedAirlines();

  if (!origin || !destination || !departDate) {
    showMessage('âš ï¸', 'è«‹å¡«å¯«å¿…è¦è³‡è¨Š', 'å‡ºç™¼åœ°ã€ç›®çš„åœ°ã€æ—¥æœŸç‚ºå¿…å¡«');
    return;
  }

  // UI: Loading
  const btn = document.getElementById('searchBtn');
  btn.disabled = true;
  btn.innerHTML = '<div class="spinner"></div> <span>æœå°‹ä¸­...</span>';
  document.getElementById('sortBar').style.display = 'none';
  showLoading();

  try {
    const qs = new URLSearchParams({
      origin, destination, departDate, adults,
      ...(returnDate && { returnDate }),
      ...(cabinClass && { cabinClass }),
      ...(airlines.length > 0 && { airlines: airlines.join(',') }),
    });

    const res = await fetch(`/api/flights/search?${qs}`);
    const data = await res.json();

    if (!data.success || (!data.outbound?.length && !data.inbound?.length)) {
      showMessage('ğŸ˜¢', 'æ²’æœ‰æ‰¾åˆ°èˆªç­',
        data.error || `${origin} â†’ ${destination} åœ¨ ${departDate} æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„èˆªç­ï¼Œè©¦è©¦å…¶ä»–æ—¥æœŸæˆ–è‰™ç­‰ï¼Ÿ`);
      return;
    }

    currentFlights = data.outbound || [];
    currentSort = 'price';
    renderFlights(currentFlights, data.elapsed);

    document.getElementById('sortBar').style.display = 'flex';

    // æ›´æ–° URLï¼ˆæ–¹ä¾¿åˆ†äº«ï¼‰
    const newUrl = `${window.location.pathname}?${qs}`;
    window.history.replaceState(null, '', newUrl);

  } catch (err) {
    showMessage('âŒ', 'æœå°‹å¤±æ•—', `ç¶²è·¯éŒ¯èª¤ï¼š${err.message}`);
  } finally {
    btn.disabled = false;
    btn.innerHTML = '<span id="searchBtnText">ğŸ” æœå°‹èˆªç­</span>';
  }
}

// =============================================
// æ’åº
// =============================================
function sortResults(btnEl, sortKey) {
  document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
  btnEl.classList.add('active');
  currentSort = sortKey;

  const sorted = [...currentFlights].sort((a, b) => {
    switch (sortKey) {
      case 'price': return (a.price || 99999) - (b.price || 99999);
      case 'depart': return (a.departTime || '').localeCompare(b.departTime || '');
      case 'duration': return parseDuration(a.duration) - parseDuration(b.duration);
      case 'stops': return (a.stops ?? 99) - (b.stops ?? 99);
      default: return 0;
    }
  });

  renderFlights(sorted);
}

function parseDuration(d) {
  if (!d) return 9999;
  const match = d.match(/(\d+)h\s*(\d+)?m?/);
  return match ? parseInt(match[1]) * 60 + (parseInt(match[2]) || 0) : 9999;
}

// =============================================
// æ¸²æŸ“
// =============================================
function renderFlights(flights, elapsed) {
  const container = document.getElementById('results');
  let html = '';

  if (elapsed) {
    html += `<div class="results-count">æ‰¾åˆ° <strong>${flights.length}</strong> ç­†èˆªç­ï¼ˆ${(elapsed/1000).toFixed(1)} ç§’ï¼‰</div>`;
  }

  flights.forEach((f, i) => {
    const airlineCode = f.airline || '';
    const color = AIRLINE_COLORS[airlineCode] || '#666';
    const airlineName = f.airlineName || AIRLINE_NAMES[airlineCode] || airlineCode;
    const cabin = f.cabinName || CABIN_NAMES[f.cabinClass] || '';
    const aircraft = AIRCRAFT_NAMES[f.aircraft] || f.aircraft || '';
    const stopsClass = f.stops === 0 ? 'stops-direct' : 'stops-transfer';
    const stopsText = f.stops === 0 ? 'ç›´é£›' : `è½‰æ©Ÿ ${f.stops} æ¬¡`;
    const price = f.price ? Number(f.price).toLocaleString() : 'â€”';
    const bookUrl = getBookingUrl(f);

    html += `
      <div class="flight-card">
        <div class="card-header">
          <div class="airline-badge">
            <span class="airline-dot" style="background:${color}"></span>
            ${airlineName}
            <span class="flight-number">${f.flightNumber || ''}</span>
          </div>
          ${cabin ? `<span class="cabin-tag">${cabin}</span>` : ''}
        </div>
        <div class="card-body">
          <div class="time-row">
            <div class="time-block">
              <div class="time">${f.departTime || '--:--'}</div>
              <div class="airport">${f.departAirport || ''}</div>
            </div>
            <div class="route-line">
              <div class="duration">${f.duration || ''}</div>
              <div class="line"></div>
              <div class="stops-label ${stopsClass}">${stopsText}</div>
            </div>
            <div class="time-block">
              <div class="time">${f.arriveTime || '--:--'}</div>
              <div class="airport">${f.arriveAirport || ''}</div>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <div>
            <div class="price"><span class="currency">TWD</span> ${price}</div>
            ${aircraft ? `<div class="aircraft-info">âœˆ ${aircraft}</div>` : ''}
          </div>
          <a class="btn-book" href="${bookUrl}" target="_blank" rel="noopener">è¨‚ç¥¨ â†’</a>
        </div>
      </div>
    `;
  });

  container.innerHTML = html;
}

function getBookingUrl(flight) {
  const code = flight.airline;
  const urls = {
    CI: 'https://www.china-airlines.com/tw/zh/booking/book-flights/flight-search',
    BR: 'https://www.evaair.com/zh-tw/booking/flight-booking/',
    JX: 'https://www.starlux-airlines.com/zh-TW/booking',
    EK: 'https://www.emirates.com/tw/chinese/book/',
    TK: 'https://www.turkishairlines.com/zh-tw/',
    CX: 'https://www.cathaypacific.com/cx/zh_TW/book-a-trip/book-flights.html',
    SQ: 'https://www.singaporeair.com/zh_TW/plan-and-book/book-a-trip/',
  };
  return urls[code] || `https://www.google.com/travel/flights?q=flights+${flight.flightNumber || ''}`;
}

function showLoading() {
  const container = document.getElementById('results');
  let html = '';
  for (let i = 0; i < 4; i++) {
    html += `
      <div class="skeleton-card">
        <div class="skeleton-line w60"></div>
        <div class="skeleton-line h24 w80"></div>
        <div class="skeleton-line w40"></div>
      </div>
    `;
  }
  container.innerHTML = html;
}

function showMessage(icon, title, desc) {
  document.getElementById('results').innerHTML = `
    <div class="status-message">
      <div class="icon">${icon}</div>
      <div class="title">${title}</div>
      <div class="desc">${desc}</div>
    </div>
  `;
}
</script>

</body>
</html>
